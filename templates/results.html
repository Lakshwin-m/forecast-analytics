<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Forecast Analytics Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: radial-gradient(
          ellipse at top,
          #020617 0%,
          #0f172a 30%,
          #020617 100%
        );
        min-height: 100vh;
      }

      .dark body {
        background: radial-gradient(
          ellipse at top,
          #020617 0%,
          #0f172a 30%,
          #020617 100%
        );
      }

      .premium-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(226, 232, 240, 0.8);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
        transition: all 0.3s ease;
      }

      .dark .premium-card {
        background: rgba(30, 41, 59, 0.95);
        border: 1px solid rgba(71, 85, 105, 0.3);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
      }

      .premium-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.12);
      }

      .dark .premium-card:hover {
        box-shadow: 0 8px 40px rgba(0, 0, 0, 0.3);
      }

      .stat-card {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .dark .stat-card {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        border: 1px solid #334155;
      }

      .gradient-text {
        background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .chart-container {
        background: rgba(255, 255, 255, 0.98);
        border: 1px solid #e5e7eb;
      }

      .dark .chart-container {
        background: rgba(15, 23, 42, 0.98);
        border: 1px solid #374151;
      }

      .control-slider {
        appearance: none;
        height: 6px;
        background: linear-gradient(90deg, #e5e7eb, #d1d5db);
        border-radius: 10px;
        outline: none;
      }

      .control-slider::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        background: #3b82f6;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        transition: all 0.2s ease;
      }

      .control-slider::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }
    </style>
  </head>
  <body class="dark min-h-screen transition-all duration-500">
    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-6 py-8 space-y-8">
      <!-- Header Section -->
      <div class="premium-card rounded-2xl p-8">
        <div
          class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6"
        >
          <div>
            <h1 class="text-4xl font-bold text-slate-900 dark:text-white mb-3">
              Forecast Analytics
            </h1>
            <p class="text-slate-600 dark:text-slate-300 text-lg font-medium">
              Advanced predictive modeling insights and performance metrics
            </p>
          </div>
          <div class="flex items-center gap-4"></div>
        </div>
      </div>

      <!-- Key Insights Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="stat-card rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div
              class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                ></path>
              </svg>
            </div>
          </div>
          <h3
            class="text-slate-600 dark:text-slate-400 font-medium text-sm uppercase tracking-wide mb-2"
          >
            Data Points
          </h3>
          <p
            id="total-points"
            class="text-2xl font-bold text-slate-900 dark:text-white"
          >
            -
          </p>
          <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">
            Total observations
          </p>
        </div>

        <div class="stat-card rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div
              class="w-12 h-12 bg-emerald-500 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
            </div>
          </div>
          <h3
            class="text-slate-600 dark:text-slate-400 font-medium text-sm uppercase tracking-wide mb-2"
          >
            Avg Generation
          </h3>
          <p
            id="avg-generation"
            class="text-2xl font-bold text-slate-900 dark:text-white"
          >
            -
          </p>
          <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">
            GW average output
          </p>
        </div>

        <div class="stat-card rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div
              class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"
                ></path>
              </svg>
            </div>
          </div>
          <h3
            class="text-slate-600 dark:text-slate-400 font-medium text-sm uppercase tracking-wide mb-2"
          >
            Capacity Factor
          </h3>
          <p
            id="capacity-factor"
            class="text-2xl font-bold text-slate-900 dark:text-white"
          >
            -
          </p>
          <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">
            % of peak capacity
          </p>
        </div>

        <div class="stat-card rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div
              class="w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                ></path>
              </svg>
            </div>
          </div>
          <h3
            class="text-slate-600 dark:text-slate-400 font-medium text-sm uppercase tracking-wide mb-2"
          >
            Peak Generation
          </h3>
          <p
            id="peak-generation"
            class="text-2xl font-bold text-slate-900 dark:text-white"
          >
            -
          </p>
          <p class="text-slate-500 dark:text-slate-400 text-sm mt-1">
            Maximum GW output
          </p>
        </div>
      </div>

      <!-- Interactive Controls -->
      <div class="premium-card rounded-2xl p-6">
        <div
          class="flex flex-col sm:flex-row items-start sm:items-center gap-6"
        >
          <div class="flex-shrink-0">
            <label
              class="block text-slate-700 dark:text-slate-300 font-semibold text-lg mb-2"
            >
              Display Range
            </label>
            <p class="text-slate-500 dark:text-slate-400 text-sm">
              Adjust the number of data points to visualize
            </p>
          </div>
          <div class="flex-1 w-full">
            <div class="flex items-center gap-4">
              <span
                class="text-slate-600 dark:text-slate-400 font-medium text-sm"
                >50</span
              >
              <input
                type="range"
                id="data-range"
                min="50"
                max="5000"
                step="10"
                value="150"
                class="control-slider flex-1"
              />
              <span
                class="text-slate-600 dark:text-slate-400 font-medium text-sm"
                >5000</span
              >
            </div>
            <div class="mt-3 text-center">
              <span
                class="inline-block px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg"
              >
                <span
                  class="text-slate-700 dark:text-slate-300 font-semibold text-lg"
                  id="current-range"
                  >150</span
                >
                <span class="text-slate-500 dark:text-slate-400 text-sm ml-1"
                  >points</span
                >
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart Section -->
      <div class="premium-card rounded-2xl p-6">
        <div class="mb-6">
          <h2 class="text-2xl font-bold text-slate-900 dark:text-white mb-2">
            Power Generation Forecast
          </h2>
          <p class="text-slate-600 dark:text-slate-300">
            Comparison between actual power generation and forecasted output
          </p>
        </div>

        <div class="chart-container rounded-xl p-4">
          <div id="forecast-chart" class="w-full h-96"></div>
        </div>

        <!-- Chart Legend -->
        <div class="mt-4 flex flex-wrap gap-4 justify-center">
          <div class="flex items-center gap-2">
            <div class="w-4 h-3 bg-blue-500 rounded"></div>
            <span class="text-slate-600 dark:text-slate-400 font-medium text-sm"
              >Actual Generation</span
            >
          </div>
          <div class="flex items-center gap-2">
            <div class="w-4 h-3 bg-orange-500 rounded"></div>
            <span class="text-slate-600 dark:text-slate-400 font-medium text-sm"
              >Forecasted Generation</span
            >
          </div>
        </div>
      </div>

      <!-- Summary Insights -->
      <div class="premium-card rounded-2xl p-6">
        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-4">
          Model Insights
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-3">
            <h4 class="font-semibold text-slate-700 dark:text-slate-300">
              Generation Analysis
            </h4>
            <p
              id="performance-insight"
              class="text-slate-600 dark:text-slate-400"
            >
              Loading generation analysis...
            </p>
          </div>
          <div class="space-y-3">
            <h4 class="font-semibold text-slate-700 dark:text-slate-300">
              Forecast Quality
            </h4>
            <p id="data-insight" class="text-slate-600 dark:text-slate-400">
              Analyzing forecast patterns...
            </p>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="text-center">
        <a
          href="/"
          class="inline-flex items-center gap-3 px-8 py-4 bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 rounded-xl hover:bg-slate-800 dark:hover:bg-slate-200 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M10 19l-7-7m0 0l7-7m-7 7h18"
            ></path>
          </svg>
          Back to Upload
        </a>
      </div>
    </div>

    <script>
      // Data from Flask (using your original structure)
      const y_true = {{ y_true|safe }};
      const y_pred = {{ y_pred|safe }};

      // Elements
      const rangeSlider = document.getElementById('data-range');
      const currentRange = document.getElementById('current-range');
      const totalPoints = document.getElementById('total-points');
      const peakGeneration = document.getElementById('peak-generation');
      const avgGeneration = document.getElementById('avg-generation');
      const capacityFactor = document.getElementById('capacity-factor');
      const performanceInsight = document.getElementById('performance-insight');
      const dataInsight = document.getElementById('data-insight');

      // Initialize
      totalPoints.textContent = y_true.length.toLocaleString();

      function updateChart(n) {
        const y_t = y_true.slice(0, n).map(val => val / 1000); // Convert MW to GW
        const y_p = y_pred.slice(0, n).map(val => val / 1000); // Convert MW to GW

        const trace1 = {
          y: y_t,
          mode: 'lines',
          name: 'Actual Generation',
          line: {color: '#3b82f6', width: 2}
        };
        const trace2 = {
          y: y_p,
          mode: 'lines',
          name: 'Forecasted Generation',
          line: {color: '#f97316', width: 2}
        };

        const layout = {
          title: {
            text: `Power Generation Forecast (${n.toLocaleString()} data points)`,
            font: {size: 18, color: '#ffffff'}
          },
          xaxis: {
            title: 'Time Period (Hours/Days)',
            gridcolor: '#374151',
            color: '#9ca3af'
          },
          yaxis: {
            title: 'Power Generation (GW)',
            gridcolor: '#374151',
            color: '#9ca3af'
          },
          plot_bgcolor: 'transparent',
          paper_bgcolor: 'transparent',
          font: {color: '#ffffff'},
          margin: {t: 60, b: 60, l: 60, r: 30}
        };

        Plotly.newPlot('forecast-chart', [trace1, trace2], layout, {responsive: true});
        updateMetrics(y_t, y_p);
      }

      function updateMetrics(actual, predicted) {
        // Peak Generation (from actual data)
        const peakActual = Math.max(...actual);
        peakGeneration.textContent = `${peakActual.toFixed(2)} GW`;

        // Average Generation (from actual data)
        const avgActual = actual.reduce((sum, val) => sum + val, 0) / actual.length;
        avgGeneration.textContent = `${avgActual.toFixed(2)} GW`;

        // Capacity Factor (percentage of peak generation)
        const capacityFactorValue = (avgActual / peakActual) * 100;
        capacityFactor.textContent = `${capacityFactorValue.toFixed(1)}%`;

        // Update insights for power generation
        const minGeneration = Math.min(...actual);
        const generationRange = peakActual - minGeneration;
        const trend = predicted[predicted.length - 1] - predicted[0];

        performanceInsight.textContent = `Power generation ranges from ${minGeneration.toFixed(2)} GW to ${peakActual.toFixed(2)} GW with an average capacity factor of ${capacityFactorValue.toFixed(1)}%. ${trend > 0 ? 'Increasing' : 'Decreasing'} trend observed in forecast.`;

        // Calculate forecast accuracy using Mean Absolute Percentage Error (MAPE)
        let mape = 0;
        for (let i = 0; i < actual.length; i++) {
          if (actual[i] !== 0) {
            mape += Math.abs((actual[i] - predicted[i]) / actual[i]);
          }
        }
        mape = (mape / actual.length) * 100;
        const accuracy = Math.max(0, 100 - mape);

        const avgPredicted = predicted.reduce((sum, val) => sum + val, 0) / predicted.length;
        const peakPredicted = Math.max(...predicted);

        dataInsight.textContent = `Forecast shows ${trend > 0 ? 'growing' : 'declining'} generation pattern with average predicted output of ${avgPredicted.toFixed(2)} GW. Peak demand forecasted at ${peakPredicted.toFixed(2)} GW. Model accuracy: ${accuracy.toFixed(1)}%.`;
      }

      // Event listeners
      rangeSlider.addEventListener('input', function() {
        const n = parseInt(this.value);
        currentRange.textContent = n.toLocaleString();
        updateChart(n);
      });

      // Initial load
      updateChart(parseInt(rangeSlider.value));
    </script>
  </body>
</html>
